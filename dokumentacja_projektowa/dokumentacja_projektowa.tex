\documentclass[12pt,a4paper,oneside]{article}

% Pakiety i konfiguracje
\RequirePackage[utf8]{inputenc}
\usepackage[QX]{polski}
\usepackage[utf8]{inputenc}
\usepackage{latexsym}
\usepackage{tgpagella}
\usepackage{lmodern}
\usepackage{amsmath,amsthm,amsfonts,amssymb,alltt}
\usepackage{epsfig}
\usepackage{pdflscape}
\usepackage{caption}
\usepackage{indentfirst}
\usepackage{float}
\usepackage{listings}
\usepackage[polish]{babel}
\usepackage{datetime2}
\usepackage[x11names,dvipsnames,table]{xcolor}
\usepackage{hyperref}
\usepackage{underscore}
\usepackage{tikz}
\usepackage[linesnumbered,lined,commentsnumbered]{algorithm2e}
\usepackage{geometry}
\tolerance=1000
\hyphenpenalty=500

% Konfiguracja pakietu geometry
\geometry{
    a4paper,
    top=2.5cm,
    bottom=2.5cm,
    left=1.5cm,
    right=1.5cm,
    headheight=15pt, % dla nagłówków, jeśli są
    includehead,
    includefoot
}


\lstset{
  basicstyle=\ttfamily\small, % Czcionka dla kodu
  keywordstyle=\color{blue}\bfseries, % Styl dla słów kluczowych
  commentstyle=\color{gray}, % Styl dla komentarzy
  stringstyle=\color{red}, % Styl dla ciągów znaków
  breaklines=true, % Łamanie linii
  breakatwhitespace=true, % Łamanie linii w miejscu spacji
  frame=single, % Ramka wokół kodu
  captionpos=b, % Pozycja podpisu (b = poniżej)
  numbers=left, % Numery linii po lewej stronie
  numberstyle=\tiny\color{gray}, % Styl numerów linii
  showstringspaces=false, % Ukrywanie spacji w ciągach znaków
  escapeinside={(*@}{@*)}, % Używanie LaTeX w kodzie
}

% Konfiguracja listowania kodu HTML
\lstset{
  language=HTML, % Ustawienie języka na HTML
  basicstyle=\ttfamily\small, % Czcionka
  keywordstyle=\color{blue}\bfseries, % Kolor słów kluczowych
  commentstyle=\color{gray}, % Kolor komentarzy
  stringstyle=\color{red}, % Kolor ciągów znaków
  breaklines=true, % Łamanie linii
  breakatwhitespace=true, % Łamanie linii w miejscu spacji
  frame=single, % Ramka wokół kodu
  captionpos=b, % Podpis pod kodem
  numbers=left, % Numery linii po lewej
  numberstyle=\tiny\color{gray}, % Styl numerów linii
  showstringspaces=false, % Ukrywanie spacji w ciągach znaków
  escapeinside={(*@}{@*)} % Używanie LaTeX w listingu
}

% Specyficzne ustawienia dla języka Python
\lstdefinelanguage{Python}{
  keywords={def, return, if, elif, else, try, except, import, from, as, pass, break, continue, lambda, with, assert},
  keywordstyle=\color{blue}\bfseries,
  ndkeywords={self, True, False, None},
  ndkeywordstyle=\color{teal}\bfseries,
  identifierstyle=\color{black},
  sensitive=true,
  comment=[l]\#,
  morecomment=[s]{"""}{"""},
  commentstyle=\color{gray}\itshape,
  stringstyle=\color{red},
  morestring=[b]',
  morestring=[b]"
}

% Specyficzne ustawienia dla języka JavaScript
\lstdefinelanguage{JavaScript}{
    keywords={var, let, const, if, else, for, while, do, break, continue, return, switch, case, default, function, this, new, try, catch, finally, throw, class, extends, import, export, default, super, debugger},
    keywordstyle=\color{blue}\bfseries,
    ndkeywords={null, true, false, console, window, document},
    ndkeywordstyle=\color{teal}\bfseries,
    identifierstyle=\color{black},
    sensitive=true,
    comment=[l]//,
    morecomment=[s]{/*}{*/},
    commentstyle=\color{gray}\itshape,
    stringstyle=\color{red},
    morestring=[b]`,
    morestring=[b]"
}


% Konfiguracja hyperref
\hypersetup{
    pdfauthor={Roman Czapla, Olaf Bar},
    colorlinks=True,
    linkcolor=darkgray,
    citecolor=BrickRed,
    filecolor=Magenta,
    urlcolor=BlueViolet
}

% Diagramy i algorytmy
\usetikzlibrary{positioning,arrows,chains,fit,shapes,calc}
\tikzset{main node/.style={circle,fill=blue!20,draw,minimum size=1cm,inner sep=0pt}}
\SetKwFor{ForEach}{for each}{do}{end for}%
\SetKwFor{ForAll}{for all}{do}{end for}%
\newenvironment{myalgorithm}
{\rule{\textwidth}{0.5mm}\\\SetAlCapSty{}\SetAlgoNoEnd\SetAlgoNoLine\begin{algorithm}}{\end{algorithm}\rule{\textwidth}{0.5mm}}

% Konfiguracja caption
\captionsetup{
    width=.95\linewidth,
    justification=centering
}

% Definicje matematyczne
\newtheorem{tw}{Twierdzenie}[section]
\newtheorem{lem}[tw]{Lemat}
\newtheorem{co}[tw]{Wniosek}
\newtheorem{prop}[tw]{Stwierdzenie}
\theoremstyle{definition}
\newtheorem{ex}{Przykład}
\newtheorem{re}[tw]{Uwaga}
\newtheorem{de}{Definicja}[section]

% Nowe komendy
\newcommand{\bC}{{\mathbb C}}
\newcommand{\bR}{{\mathbb R}}
\newcommand{\bZ}{{\mathbb Z}}
\newcommand{\bQ}{{\mathbb Q}}
\newcommand{\bN}{{\mathbb N}}
\newcommand{\captionT}[1]{\caption{\textsc{\footnotesize{#1}}}}
\renewcommand\figurename{Rys.}
\numberwithin{equation}{section}
\renewcommand{\thefootnote}{\arabic{footnote})}

\begin{document}
\renewcommand{\thepage}{\arabic{page}}
% --------------------------------------------
% Strona tytułowa
% --------------------------------------------

\thispagestyle{empty} % Ustawienie pustego stylu dla strony tytułowej
\begin{titlepage}
\begin{center}\Large
Uniwersytet Komisji Edukacji Narodowej w Krakowie\\
\large
Instytut Bezpieczeństwa i Informatyki\\
\vskip 10pt
\end{center}
\begin{center}
\centering \includegraphics[width=1.0\columnwidth]{images/logo.png}
\end{center}

\begin{center}
 {\bf \fontsize{14pt}{14pt}\selectfont PROJEKT INŻYNIERSKI \\ DOKUMENTACJA PROJEKTOWA}
\end{center}
\vskip 5pt
\begin{center}
 {\bf \fontsize{15pt}{25pt}\selectfont System rekomendacji produktów. Tworzenie algorytmu rekomendacyjnego na
 podstawie preferencji użytkowników – aplikacja przeglądarkowa}
\end{center}

\begin{center}
 {\fontsize{12pt}{12pt}\selectfont wykonany przez: }
\end{center}
\begin{center}
 {\bf\fontsize{16pt}{16pt}\selectfont Grzegorz x}\\
 {\fontsize{12pt}{12pt}\selectfont Nr albumu:  xxxx \\\&\\}
 {\bf\fontsize{16pt}{16pt}\selectfont Krzysztof x }\\
 {\fontsize{12pt}{12pt}\selectfont Nr albumu: x \\\&\\}
 {\bf\fontsize{16pt}{16pt}\selectfont Maciej x }\\
 {\fontsize{12pt}{12pt}\selectfont Nr albumu: x}
\end{center}
\begin{center}
 {\fontsize{12pt}{12pt}\selectfont pod opieką:}\\
 {\bf\fontsize{12pt}{12pt}\selectfont dr hab. inż.x x  }
\end{center}

\vspace*{\fill} % Dostosowanie dopełnienia do końca strony
\begin{center}
\large
Kraków \the\year\\
(ostatnia aktualizacja: \DTMcurrenttime,\;\today)
\end{center}
\end{titlepage}

\clearpage %

\tableofcontents


\newpage

\section{Szczegółowa dokumentacja projektowa}
\textit{W zależności od specyfiki projektu! Wymienione niżej podpunkty mają charakter orientacyjny.}
\subsection{Projekt UML}
\textit{W szczególności: diagram klas, ew. np. przypadki użycia, diagramy sekwencji, czynności, stanów, obiektów/komponentów/pakietów itp.}
\begin{center}
\centering \includegraphics[width=1.0\columnwidth]{images/UML.jpg}
\end{center}

\subsection{Projekt bazy danych}

\subsubsection*{Tabela \texttt{Address}}
\textbf{Opis:} Przechowuje informacje o adresach użytkowników.
\begin{itemize}
    \item \texttt{street} : varchar(255) – ulica
    \item \texttt{city} : varchar(100) – miasto
    \item \texttt{postal\string_code} : varchar(20) – kod pocztowy
    \item \texttt{country} : varchar(100) – kraj
    \item \texttt{is\string_default} : bool – flaga domyślnego adresu
    \item \texttt{user\string_id} : bigint (klucz obcy do \texttt{User})
    \item \texttt{id} : integer (klucz główny)
\end{itemize}

\subsubsection*{Tabela \texttt{Cart}}
\textbf{Opis:} Przechowuje informacje o koszykach zakupowych.
\begin{itemize}
    \item \texttt{created\string_at} : datetime – data utworzenia koszyka
    \item \texttt{updated\string_at} : datetime – data ostatniej aktualizacji
    \item \texttt{user\string_id} : bigint (klucz obcy do \texttt{User})
    \item \texttt{id} : integer (klucz główny)
\end{itemize}

\subsubsection*{Tabela \texttt{CartItem}}
\textbf{Opis:} Przechowuje informacje o produktach w koszyku.
\begin{itemize}
    \item \texttt{quantity} : integer unsigned – ilość produktu
    \item \texttt{added\string_at} : datetime – data dodania produktu
    \item \texttt{cart\string_id} : bigint (klucz obcy do \texttt{Cart})
    \item \texttt{product\string_id} : bigint (klucz obcy do \texttt{Product})
    \item \texttt{id} : integer (klucz główny)
\end{itemize}

\subsubsection*{Tabela \texttt{Category}}
\textbf{Opis:} Przechowuje informacje o kategoriach produktów.
\begin{itemize}
    \item \texttt{name} : varchar(100) – nazwa kategorii
    \item \texttt{description} : text – opis kategorii
    \item \texttt{id} : integer (klucz główny)
\end{itemize}

\subsubsection*{Tabela \texttt{Category\string_parent}}
\textbf{Opis:} Definiuje relacje hierarchiczne między kategoriami.
\begin{itemize}
    \item \texttt{from\string_category\string_id} : bigint (klucz obcy do \texttt{Category})
    \item \texttt{to\string_category\string_id} : bigint (klucz obcy do \texttt{Category})
    \item \texttt{id} : integer (klucz główny)
\end{itemize}

\subsubsection*{Tabela \texttt{Conversation}}
\textbf{Opis:} Przechowuje informacje o rozmowach.
\begin{itemize}
    \item \texttt{created\string_at} : datetime – data utworzenia rozmowy
    \item \texttt{is\string_admin\string_conversation} : bool – flaga rozmowy administracyjnej
    \item \texttt{order\string_id} : bigint (klucz obcy do \texttt{Order})
    \item \texttt{id} : integer (klucz główny)
\end{itemize}

\subsubsection*{Tabela \texttt{Conversation\string_participants}}
\textbf{Opis:} Przechowuje uczestników rozmowy.
\begin{itemize}
    \item \texttt{conversation\string_id} : bigint (klucz obcy do \texttt{Conversation})
    \item \texttt{user\string_id} : bigint (klucz obcy do \texttt{User})
    \item \texttt{id} : integer (klucz główny)
\end{itemize}

\subsubsection*{Tabela \texttt{Message}}
\textbf{Opis:} Przechowuje wiadomości w rozmowach.
\begin{itemize}
    \item \texttt{content} : text – treść wiadomości
    \item \texttt{timestamp} : datetime – znacznik czasu wiadomości
    \item \texttt{is\string_read} : bool – flaga odczytania wiadomości
    \item \texttt{conversation\string_id} : bigint (klucz obcy do \texttt{Conversation})
    \item \texttt{sender\string_id} : bigint (klucz obcy do \texttt{User})
    \item \texttt{id} : integer (klucz główny)
\end{itemize}

\subsubsection*{Tabela \texttt{Order}}
\textbf{Opis:} Przechowuje informacje o zamówieniach.
\begin{itemize}
    \item \texttt{status} : varchar(20) – status zamówienia
    \item \texttt{previous\string_status} : varchar(20) – poprzedni status
    \item \texttt{created\string_at} : datetime – data utworzenia
    \item \texttt{total\string_amount} : decimal – łączna kwota
    \item \texttt{delivery\string_address\string_id} : bigint (klucz obcy do \texttt{Address})
    \item \texttt{user\string_id} : bigint (klucz obcy do \texttt{User})
    \item \texttt{payment\string_method\string_id} : bigint (klucz obcy do \texttt{PaymentMethod})
    \item \texttt{id} : integer (klucz główny)
\end{itemize}

\subsubsection*{Tabela \texttt{PaymentMethod}}
\textbf{Opis:} Przechowuje informacje o metodach płatności.
\begin{itemize}
    \item \texttt{payment\string_method} : varchar(20) – typ metody
    \item \texttt{card\string_number} : varchar(16) – numer karty
    \item \texttt{expiration\string_date} : varchar(5) – data ważności
    \item \texttt{cvv} : varchar(4) – kod CVV
    \item \texttt{blik\string_code} : varchar(6) – kod Blik
    \item \texttt{user\string_id} : bigint (klucz obcy do \texttt{User})
    \item \texttt{id} : integer (klucz główny)
\end{itemize}

\subsubsection*{Tabela \texttt{Product}}
\textbf{Opis:} Przechowuje informacje o produktach.
\begin{itemize}
    \item \texttt{name} : varchar(100) – nazwa produktu
    \item \texttt{brand} : varchar(100) – marka produktu
    \item \texttt{image} : varchar(100) – obraz produktu
    \item \texttt{description} : text – opis produktu
    \item \texttt{price} : decimal – cena produktu
    \item \texttt{average\string_rate} : decimal – średnia ocena
    \item \texttt{product\string_details} : text – szczegóły produktu
    \item \texttt{product\string_images\string_links} : text – linki do zdjęć
    \item \texttt{id} : integer (klucz główny)
\end{itemize}

\subsubsection*{Tabela \texttt{Order\string_products}}
\textbf{Opis:} Przechowuje informacje o produktach w zamówieniach.
\begin{itemize}
    \item \texttt{order\string_id} : bigint (klucz obcy do \texttt{Order})
    \item \texttt{product\string_id} : bigint (klucz obcy do \texttt{Product})
    \item \texttt{id} : integer (klucz główny)
\end{itemize}

\subsubsection*{Tabela \texttt{Product\string_categories}}
\textbf{Opis:} Przechowuje relacje między produktami a kategoriami.
\begin{itemize}
    \item \texttt{product\string_id} : bigint (klucz obcy do \texttt{Product})
    \item \texttt{category\string_id} : bigint (klucz obcy do \texttt{Category})
    \item \texttt{id} : integer (klucz główny)
\end{itemize}

\subsubsection*{Tabela \texttt{Product\string_liked\string_by}}
\textbf{Opis:} Przechowuje informacje o użytkownikach, którzy polubili produkty.
\begin{itemize}
    \item \texttt{product\string_id} : bigint (klucz obcy do \texttt{Product})
    \item \texttt{user\string_id} : bigint (klucz obcy do \texttt{User})
    \item \texttt{id} : integer (klucz główny)
\end{itemize}

\subsubsection*{Tabela \texttt{RecommendedProducts}}
\textbf{Opis:} Przechowuje listy rekomendowanych produktów.
\begin{itemize}
    \item \texttt{added\string_at} : datetime – data dodania listy
    \item \texttt{user\string_id} : bigint (klucz obcy do \texttt{User})
    \item \texttt{id} : integer (klucz główny)
\end{itemize}

\subsubsection*{Tabela \texttt{RecommendedProducts\string_products}}
\textbf{Opis:} Przechowuje produkty powi\k{a}zane z rekomendacjami.
\begin{itemize}
    \item \texttt{RecommendedProducts\string_id} : bigint (klucz obcy do \texttt{RecommendedProducts})
    \item \texttt{product\string_id} : bigint (klucz obcy do \texttt{Product})
    \item \texttt{id} : integer (klucz główny)
\end{itemize}

\subsubsection*{Tabela \texttt{User\string_groups}}
\textbf{Opis:} Przechowuje relacje między użytkownikami a grupami.
\begin{itemize}
    \item \texttt{user\string_id} : bigint (klucz obcy do \texttt{User})
    \item \texttt{group\string_id} : integer (klucz obcy do \texttt{Auth\string_group})
    \item \texttt{id} : integer (klucz główny)
\end{itemize}

\subsubsection*{Tabela \texttt{UserCategoryVisibility}}
\textbf{Opis:} Przechowuje informacje o widoczności kategorii dla użytkowników.
\begin{itemize}
    \item \texttt{view\string_date} : datetime – data widoczności
    \item \texttt{category\string_id} : bigint (klucz obcy do \texttt{Category})
    \item \texttt{user\string_id} : bigint (klucz obcy do \texttt{User})
    \item \texttt{id} : integer (klucz główny)
\end{itemize}

\subsubsection*{Tabela \texttt{UserQueryLog}}
\textbf{Opis:} Przechowuje zapytania wykonane przez użytkowników.
\begin{itemize}
    \item \texttt{query} : varchar(255) – treść zapytania
    \item \texttt{query\string_date} : datetime – data zapytania
    \item \texttt{user\string_id} : bigint (klucz obcy do \texttt{User})
    \item \texttt{id} : integer (klucz główny)
\end{itemize}

\subsubsection*{Tabela \texttt{Profile}}
\textbf{Opis:} Przechowuje informacje o profilach użytkowników.
\begin{itemize}
    \item \texttt{last\string_opened\string_conversation\string_id} : bigint (klucz obcy do \texttt{Conversation})
    \item \texttt{user\string_id} : bigint (klucz obcy do \texttt{User})
    \item \texttt{id} : integer (klucz główny)
\end{itemize}

\subsubsection*{Tabela \texttt{Rate}}
\textbf{Opis:} Przechowuje oceny produktów wystawione przez użytkowników.
\begin{itemize}
    \item \texttt{value} : integer – wartość oceny
    \item \texttt{comment} : text – komentarz do oceny
    \item \texttt{created\string_at} : datetime – data wystawienia oceny
    \item \texttt{product\string_id} : bigint (klucz obcy do \texttt{Product})
    \item \texttt{user\string_id} : bigint (klucz obcy do \texttt{User})
    \item \texttt{id} : integer (klucz główny)
\end{itemize}

\subsubsection*{Tabela \texttt{Reaction}}
\textbf{Opis:} Przechowuje reakcje użytkowników na produkty.
\begin{itemize}
    \item \texttt{assigned\string_date} : datetime – data przypisania reakcji
    \item \texttt{type} : varchar(10) – typ reakcji (np. „like” lub „dislike”)
    \item \texttt{product\string_id} : bigint (klucz obcy do \texttt{Product})
    \item \texttt{user\string_id} : bigint (klucz obcy do \texttt{User})
    \item \texttt{id} : integer (klucz główny)
\end{itemize}

\subsubsection*{Tabela \texttt{UserProductVisibility}}
\textbf{Opis:} Przechowuje informacje o widoczności produktów dla użytkowników.
\begin{itemize}
    \item \texttt{view\string_date} : datetime – data widoczności
    \item \texttt{product\string_id} : bigint (klucz obcy do \texttt{Product})
    \item \texttt{user\string_id} : bigint (klucz obcy do \texttt{User})
    \item \texttt{id} : integer (klucz główny)
\end{itemize}

\subsubsection*{Tabela \texttt{UserRecommendedProductInteraction}}
\textbf{Opis:} Przechowuje informacje o interakcjach użytkowników z rekomendowanymi produktami.
\begin{itemize}
    \item \texttt{interaction\string_type} : varchar(20) – typ interakcji (np. kliknięcie, zakup)
    \item \texttt{interaction\string_date} : datetime – data interakcji
    \item \texttt{product\string_id} : bigint (klucz obcy do \texttt{Product})
    \item \texttt{user\string_id} : bigint (klucz obcy do \texttt{User})
    \item \texttt{id} : integer (klucz główny)
\end{itemize}

\subsubsection*{Tabela \texttt{User\string_user\string_permissions}}
\textbf{Opis:} Przechowuje informacje o uprawnieniach użytkowników.
\begin{itemize}
    \item \texttt{user\string_id} : bigint (klucz obcy do \texttt{User})
    \item \texttt{permission\string_id} : integer (klucz obcy do \texttt{Auth\string_permission})
    \item \texttt{id} : integer (klucz główny)
\end{itemize}

\subsubsection*{Tabela \texttt{User\string_query\string_log}}
\textbf{Opis:} Przechowuje zapytania wyszukiwania wykonane przez użytkowników.
\begin{itemize}
    \item \texttt{query} : varchar(255) – treść zapytania
    \item \texttt{query\string_date} : datetime – data zapytania
    \item \texttt{user\string_id} : bigint (klucz obcy do \texttt{User})
    \item \texttt{id} : integer (klucz główny)
\end{itemize}


\section*{Relacje między tabelami}
\begin{itemize}
    \item \texttt{Address.user\string_id} $\to$ \texttt{User.id}
    \item \texttt{Cart.user\string_id} $\to$ \texttt{User.id}
    \item \texttt{CartItem.cart\string_id} $\to$ \texttt{Cart.id}
    \item \texttt{CartItem.product\string_id} $\to$ \texttt{Product.id}
    \item \texttt{Category\string_parent.from\string_category\string_id} $\to$ \texttt{Category.id}
    \item \texttt{Category\string_parent.to\string_category\string_id} $\to$ \texttt{Category.id}
    \item \texttt{Conversation.order\string_id} $\to$ \texttt{Order.id}
    \item \texttt{Conversation\string_participants.conversation\string_id} $\to$ \texttt{Conversation.id}
    \item \texttt{Conversation\string_participants.user\string_id} $\to$ \texttt{User.id}
    \item \texttt{Message.conversation\string_id} $\to$ \texttt{Conversation.id}
    \item \texttt{Message.sender\string_id} $\to$ \texttt{User.id}
    \item \texttt{Order\string_products.order\string_id} $\to$ \texttt{Order.id}
    \item \texttt{Order\string_products.product\string_id} $\to$ \texttt{Product.id}
    \item \texttt{Product\string_categories.product\string_id} $\to$ \texttt{Product.id}
    \item \texttt{Product\string_categories.category\string_id} $\to$ \texttt{Category.id}
    \item \texttt{Product\string_liked\string_by.product\string_id} $\to$ \texttt{Product.id}
    \item \texttt{Product\string_liked\string_by.user\string_id} $\to$ \texttt{User.id}
    \item \texttt{RecommendedProducts\string_products.recommendedproducts\string_id} $\to$ \texttt{RecommendedProducts.id}
    \item \texttt{RecommendedProducts\string_products.product\string_id} $\to$ \texttt{Product.id}
    \item \texttt{User\string_groups.user\string_id} $\to$ \texttt{User.id}
    \item \texttt{UserCategoryVisibility.category\string_id} $\to$ \texttt{Category.id}
    \item \texttt{Profile.last\string_opened\string_conversation\string_id} $\to$ \texttt{Conversation.id}
    \item \texttt{Rate.product\string_id} $\to$ \texttt{Product.id}
    \item \texttt{Rate.user\string_id} $\to$ \texttt{User.id}
    \item \texttt{Reaction.product\string_id} $\to$ \texttt{Product.id}
    \item \texttt{Reaction.user\string_id} $\to$ \texttt{User.id}
    \item \texttt{UserRecommendedProductInteraction.product\string_id} $\to$ \texttt{Product.id}
    \item \texttt{UserRecommendedProductInteraction.user\string_id} $\to$ \texttt{User.id}
\end{itemize}


\subsubsection*{Przykładowe procedury składowane}

\subsubsection*{Dodawanie nowego użytkownika}
\begin{verbatim}
CREATE OR REPLACE PROCEDURE add_user(
    p_username VARCHAR,
    p_email VARCHAR,
    p_password VARCHAR
)
BEGIN
    INSERT INTO User (username, email, password)
    VALUES (p_username, p_email, p_password);
END;
\end{verbatim}

\subsubsection*{Pobieranie zamówień użytkownika}
\begin{verbatim}
CREATE OR REPLACE FUNCTION get_user_orders(p_user_id INT)
RETURNS TABLE(order_id INT, order_date DATETIME, status VARCHAR)
BEGIN
    RETURN QUERY
    SELECT id, order_date, status
    FROM Order
    WHERE user_id = p_user_id;
END;
\end{verbatim}

\clearpage
\subsection{Szczegółowa dokumentacja kodu}
Poniżej przedstawiono szczegółową dokumentację dotyczącą implementacji aplikacji. Dokumentacja obejmuje:
\begin{itemize}
\item \textit{opis najważniejszych zmiennych;}
\item \textit{specyfikacja i opis wszystkich klas (jeśli projekt obiektowy) - opis całej klasy, jej pól i metod (jak poniżej);}
\item \textit{opis funkcji oraz metod klas (co robią, opis poszczególnych parametrów wejściowych i zwracanych wartości itp.) oraz w przypadku bibliotek programistycznych - przykłady użycia (przykładowy kod);} 
\item \textit{opis użytych wzorców projektowych.}
\end{itemize}
% User Model details documentation 
\subsubsection{Model \texttt{User}}
\textbf{Opis:} 
Model \texttt{User} rozszerza wbudowany model \texttt{AbstractUser} i przechowuje informacje o użytkownikach systemu, takie jak dane personalne, datę rejestracji, numer telefonu oraz płeć. Wprowadza dodatkowe pola, które uzupełniają funkcjonalności dziedziczone z \texttt{AbstractUser}.

\textbf{Pola dodane w modelu \texttt{User}:}
\begin{itemize}
    \item \texttt{email}: \texttt{EmailField} – unikalny adres e-mail użytkownika (nadpisuje pole z \texttt{AbstractUser}).
    \item \texttt{birthday}: \texttt{DateField} – data urodzenia użytkownika (opcjonalne).
    \item \texttt{registration\_date}: \texttt{DateTimeField} – data rejestracji użytkownika (domyślnie ustawiana na bieżącą datę i czas).
    \item \texttt{phone\_number}: \texttt{CharField} – numer telefonu użytkownika (wymagane, maksymalnie 15 znaków).
    \item \texttt{is\_admin}: \texttt{BooleanField} – flaga wskazująca, czy użytkownik jest administratorem.
    \item \texttt{gender}: \texttt{CharField} – płeć użytkownika, wybierana spośród wartości:
    \begin{itemize}
        \item \texttt{Male}
        \item \texttt{Female}
        \item \texttt{Other}
    \end{itemize}
\end{itemize}

\textbf{Pola dziedziczone z modelu \texttt{AbstractUser}:}
\begin{itemize}
    \item \texttt{password}: \texttt{CharField} – hasło użytkownika (zabezpieczone poprzez funkcję \texttt{set\_password}).
    \item \texttt{last\_login}: \texttt{DateTimeField} – data ostatniego logowania użytkownika.
    \item \texttt{is\_superuser}: \texttt{BooleanField} – flaga oznaczająca, czy użytkownik jest superużytkownikiem.
    \item \texttt{username}: \texttt{CharField} – unikalna nazwa użytkownika.
    \item \texttt{first\_name}: \texttt{CharField} – imię użytkownika.
    \item \texttt{last\_name}: \texttt{CharField} – nazwisko użytkownika.
    \item \texttt{is\_staff}: \texttt{BooleanField} – flaga wskazująca, czy użytkownik ma uprawnienia do panelu administracyjnego.
    \item \texttt{is\_active}: \texttt{BooleanField} – flaga wskazująca, czy konto użytkownika jest aktywne.
    \item \texttt{date\_joined}: \texttt{DateTimeField} – data utworzenia konta użytkownika.
\end{itemize}

\subsubsection*{Metody modelu}
\begin{itemize}
    \item \texttt{\_\_str\_\_(self)}:
    \begin{itemize}
        \item \textbf{Opis:} Zwraca czytelną reprezentację użytkownika w formacie: \\
        \texttt{User <imie> <nazwisko> <email> \ Gender: <płeć>}.
        \item \textbf{Przykład:}
        \begin{lstlisting}
    user = User.objects.get(id=1)
    print(user)  # Output: User John Doe john.doe@example.com Gender: Male
        \end{lstlisting}
    \end{itemize}
\end{itemize}

\subsubsection*{Formularze związane z modelem}

\paragraph{Formularz rejestracji (\texttt{UserRegistrationForm})}

\begin{itemize}
    \item \textbf{Opis:} Formularz umożliwiający rejestrację nowego użytkownika w systemie.
    \item \textbf{Pola:} 
    \begin{itemize}
        \item \texttt{first\_name}, \texttt{last\_name}, \texttt{email}, \texttt{phone\_number}, \texttt{birthday}, \texttt{gender}, \texttt{password}.
    \end{itemize}
    % Metody walidacji 
    \subsubsection*{Metody walidacji formularza}
    \begin{itemize}
        %  Metoda clean_email
        \item \texttt{clean\_email}
        \begin{itemize}
            \item \textbf{Opis:} Sprawdza, czy adres e-mail jest unikalny i należy do poprawnej domeny.
            \item \textbf{Kod:}
            \begin{lstlisting}[language=Python, caption=Kod metody clean\_email]
def clean_email(self):
    email = self.cleaned_data.get("email")
    if User.objects.filter(email=email).exists():
        raise forms.ValidationError(f"Email is already taken")
    elif "@" in email:
        domain = email.split("@")[1]
        if domain.split(".")[-1] not in POSSIBLE_EMAIL_DOMAIN_TLD:
            raise forms.ValidationError("Given email domain not recognized")
    return email
        \end{lstlisting}
        \item \textbf{Przykład:}
        \begin{verbatim}
Input: email = "invalid_domain@fake_domain.notreal"
Output: ValidationError: "Given email domain not recognized"
            \end{verbatim}
        \end{itemize}
    
        %  Metoda clean_phone_number
        \item \texttt{clean\_phone\_number}
        \begin{itemize}
            \item \textbf{Opis:} Upewnia się, że numer telefonu zawiera dokładnie 9 cyfr.
            \item \textbf{Kod:}
            \begin{lstlisting}[language=Python, caption=Kod metody clean\_phone\_number]
def clean_phone_number(self):
    phone_number = self.cleaned_data.get("phone_number")
    parsed_phone_number = re.sub(r'\D', '', phone_number)
    if len(parsed_phone_number) != 9:
        raise ValidationError("Phone number must have exactly 9 digits.")
    return parsed_phone_number
        \end{lstlisting}
        \item \textbf{Przykład:}
        \begin{verbatim}
Input: phone_number = "+48 123-456-789"
Output: "123456789"
            \end{verbatim}
        \end{itemize}
    \end{itemize}
\clearpage % mowing to other page 
    \item \textbf{Metody:}
    \item \texttt{generate\_username(first\_name, last\_name)}
    \begin{itemize}
        \item \textbf{Opis:} Generuje unikalną nazwę użytkownika na podstawie imienia i nazwiska. Jeśli istnieje już użytkownik o takiej nazwie, metoda dodaje liczbę do nazwy, aby zapewnić jej unikalność.
        \item \textbf{Kod:}
        \begin{lstlisting}[language=Python, caption=Kod metody generate\_username]
@staticmethod
def generate_username(first_name, last_name):
    first_name = first_name.lower()
    last_name = last_name.lower()

    if " " in first_name:
        first_name = "_".join(first_name.split())
    if " " in last_name:
        last_name = "_".join(last_name.split())

    username = f"{first_name}.{last_name}"
    num = 1

    while User.objects.filter(username=username).exists():
        username = f"{first_name}.{last_name}{num}"
        num += 1

    return username
        \end{lstlisting}
        \item \textbf{Przykład:}
        \begin{verbatim}
    Input: first_name = "John", last_name = "Doe"
    Output: "john.doe"

    Input: first_namqe = "John", last_name = "Doe" (if "john.doe" already exists)
    Output: "john.doe1"
        \end{verbatim}
    \end{itemize}
\end{itemize}

% \clearpage % mowing to other page 
\paragraph{Formularz logowania (\texttt{UserLoginForm})}

\begin{itemize}
    \item \textbf{Opis:} Formularz umożliwiający logowanie użytkownika na podstawie adresu e-mail i hasła.
    \item \textbf{Pola:}
    \begin{itemize}
        \item \texttt{email}, \texttt{password}.
    \end{itemize}
\end{itemize}

\subsubsection*{Widoki związane z modelem}

\paragraph{\texttt{UserRegisterView}}
\begin{itemize}
    \item \textbf{Opis:} Widok umożliwiający użytkownikom rejestrację w systemie.
    \item \textbf{Atrybuty:}
    \begin{itemize}
        \item \texttt{template\_name}: Ścieżka do szablonu używanego dla rejestracji (\texttt{"registration/register.html"}). 
        Kod szablonu został szczegółowo opisany w sekcji \ref{sec:register_template}.
        \item \texttt{form\_class}: Formularz używany w widoku rejestracji (\texttt{UserRegistrationForm}).
        \item \texttt{success\_url}: URL, na który użytkownik jest przekierowywany po pomyślnej rejestracji (\texttt{"login"}).
    \end{itemize}
    \item \textbf{Metody:}
    \begin{itemize}
        \item \texttt{form\_valid(self, form)}:
        \begin{itemize}
            \item \textbf{Opis:} Obsługuje poprawne przesłanie formularza rejestracji.
            \item \textbf{Kod:}
            \begin{lstlisting}[language=Python, caption=Metoda form\_valid w UserRegisterView]
def form_valid(self, form):
    form.save(commit=True)
    messages.success(self.request, "Registered successfully")
    send_registration_email(form.cleaned_data['email'], form.cleaned_data['first_name'])
    return super().form_valid(form)
            \end{lstlisting}
            \item \textbf{Wyjaśnienie:}
            \begin{itemize}
                \item Zapisuje nowego użytkownika w bazie danych.
                \item Wyświetla komunikat o sukcesie przy użyciu systemu wiadomości Django.
                \item Wysyła e-mail z potwierdzeniem rejestracji na adres użytkownika.  (szczegóły funkcji \texttt{send\_registration\_email} w sekcji \ref{sec:helper_functions}).
            \end{itemize}
        \end{itemize}
        \item \texttt{form\_invalid(self, form)}:
        \begin{itemize}
            \item \textbf{Opis:} Obsługuje niepoprawne przesłanie formularza.
            \item \textbf{Kod:}
            \begin{lstlisting}[language=Python, caption=Metoda form\_invalid w UserRegisterView]
def form_invalid(self, form):
    return super().form_invalid(form)
            \end{lstlisting}
            \item \textbf{Wyjaśnienie:}
            \begin{itemize}
                \item Przekazuje niepoprawny formularz do szablonu w celu wyświetlenia błędów.
            \end{itemize}
        \end{itemize}
    \end{itemize}
\end{itemize}

\paragraph{\texttt{UserLoginView}}
\begin{itemize}
    \item \textbf{Opis:} Widok umożliwiający logowanie użytkownika.
    \item \textbf{Atrybuty:}
    \begin{description}
        \item[\texttt{template\_name}] Ścieżka do szablonu logowania (\texttt{"registration/login.html"}).\\
        \hspace{1cm} Kod szablonu został szczegółowo opisany w sekcji \ref{sec:login_template}.
        \item[\texttt{form\_class}] Formularz używany w widoku logowania (\texttt{UserLoginForm}).
        \item[\texttt{success\_url}] URL, na który użytkownik jest przekierowywany po pomyślnym zalogowaniu (\texttt{"home"}).
    \end{description}
    \item \textbf{Metody:}
    \begin{itemize}
    \item \texttt{form\_valid(self, form)}:
    \begin{itemize}
        \item \textbf{Opis:} Obsługuje poprawne przesłanie formularza logowania.
        \item \textbf{Kod:}
        \begin{lstlisting}[language=Python, caption=Metoda form\_valid w UserLoginView]
def form_valid(self, form):
    email = form.cleaned_data.get('email')
    password = form.cleaned_data.get('password')
    try:
        user = User.objects.get(email=email)
        username = user.username
        user = authenticate(self.request, username=username, password=password)
        if user is not None:
            login(self.request, user)
            messages.success(self.request, "Login successfully")
            sync_session_likes_to_user(self.request)
            return super().form_valid(form)
        else:
            form.add_error(None, "Incorrect email or password")
    except User.DoesNotExist:
        form.add_error('email', "No user found with the given email address")
    return self.form_invalid(form)
            \end{lstlisting}
            \item \textbf{Wyjaśnienie:}
            \begin{itemize}
                \item Pobiera dane logowania z formularza (\texttt{email}, \texttt{password}).
                \item Wyszukuje użytkownika na podstawie adresu e-mail.
                \item Próbuje uwierzytelnić użytkownika za pomocą funkcji \texttt{authenticate}.
                \item Jeśli uwierzytelnienie powiedzie się, loguje użytkownika i wyświetla komunikat o sukcesie.
                \item Jeśli uwierzytelnienie nie powiedzie się, dodaje odpowiednie błędy do formularza.
            \end{itemize}
        \end{itemize}
    \end{itemize}
\end{itemize}


\subsubsection*{Endpointy związane z modelem}

\begin{itemize}
    \item \texttt{/register/} – rejestracja użytkownika (\texttt{UserRegisterView}).
    \item \texttt{/login/} – logowanie użytkownika (\texttt{UserLoginView}).
    \item \texttt{/logout/} – wylogowanie użytkownika (\texttt{logout\_view}).
\end{itemize}

\subsubsection*{Szablony użytkownika}
\label{sec:user_templates}

\paragraph{\texttt{login.html}}
\label{sec:login_template}

Szablon odpowiedzialny za logowanie użytkownika do systemu. Poniżej przedstawiono fragment kodu HTML użytego w szablonie:

\begin{lstlisting}[language=HTML, caption=Szablon login.html]
    <form method="post" action="{% url 'login' %}">
        {% csrf_token %}
        <label for="id_email">Email:</label>
        <input type="email" name="email" id="id_email" required>
        <label for="id_password">Haslo:</label>
        <input type="password" name="password" id="id_password" required>
        <button type="submit">Zaloguj sie</button>
    </form>
\end{lstlisting}

\textbf{Wyjaśnienie:}
\begin{itemize}
    \item \texttt{method="post"}: Określa metodę przesyłania danych (HTTP POST).
    \item \texttt{{\% csrf\_token \%}}: Token zabezpieczający przed atakami CSRF (wymagany w Django).
    \item \texttt{name="email"}: Pole do wprowadzenia adresu e-mail.
    \item \texttt{name="password"}: Pole do wprowadzenia hasła użytkownika.
    \item Przycisk \texttt{submit}: Służy do przesłania formularza do widoku logowania.
\end{itemize}

\begin{figure}[H] % 'H' wymusza umieszczenie w bieżącym miejscu
    \paragraph{\texttt{register.html}}
    \label{sec:register_template}
    Szablon odpowiedzialny za rejestrację nowych użytkowników. Poniżej przedstawiono fragment kodu HTML użytego w szablonie:
    \begin{lstlisting}[language=HTML, caption=Szablon register.html]
        <form method="post" action="{% url 'register_user' %}">
            {% csrf_token %}
            <label for="id_first_name">Imie:</label>
            <input type="text" name="first_name" id="id_first_name" required>
            <label for="id_last_name">Nazwisko:</label>
            <input type="text" name="last_name" id="id_last_name" required>
            <label for="id_email">Email:</label>
            <input type="email" name="email" id="id_email" required>
            <button type="submit">Zarejestruj sie</button>
        </form>
    \end{lstlisting}
    \end{figure}

\textbf{Wyjaśnienie:}
\begin{itemize}
    \item \texttt{name="first\_name"}: Pole do wprowadzenia imienia użytkownika.
    \item \texttt{name="last\_name"}: Pole do wprowadzenia nazwiska użytkownika.
    \item \texttt{name="email"}: Pole do wprowadzenia adresu e-mail.
    \item Token CSRF i przycisk \texttt{submit}: Działają analogicznie do tych w \texttt{login.html}.
\end{itemize}

\textbf{Uwagi:}
\begin{itemize}
    \item Oba szablony korzystają z tokenu CSRF, co jest standardem w Django w celu zapewnienia bezpieczeństwa.
    \item Formularze wykorzystują prostą strukturę HTML. Rozbudowa o dodatkowe style CSS lub framework (np. Bootstrap) jest możliwa w dalszym rozwoju aplikacji.
\end{itemize}

\subsection{Funkcje pomocnicze}
\label{sec:helper_functions}

\begin{figure}[H] %
    \paragraph{\texttt{send\_registration\_email(email, user)}}
    Funkcja pomocnicza odpowiedzialna za wysyłanie e-maila potwierdzającego rejestrację użytkownika.
    \begin{lstlisting}[language=Python, caption=Funkcja send_registration_email]
    def send_registration_email(email, user):
        subject = 'Rejestracja w KMG Store'
        html_message = render_to_string('email/registration_email.html', {'user': user})
        plain_message = strip_tags(html_message)
        from_email = 'kmgstoreproject@gmail.com'
        to = email

        send_mail(subject, plain_message, from_email, [to], html_message=html_message)
    \end{lstlisting}

    \textbf{Opis działania:}
    \begin{itemize}
        \item Pobiera e-mail użytkownika oraz obiekt użytkownika jako parametry wejściowe.
        \item Generuje temat wiadomości oraz treść HTML za pomocą szablonu \texttt{registration\_email.html}.
        \item Wysyła e-mail za pomocą funkcji \texttt{send\_mail} Django.
    \end{itemize}
\end{figure}


\subsubsection*{Zastosowane wzorce projektowe}

\begin{itemize}
    \item \textbf{Wzorzec Template Method:} Widoki \texttt{UserRegisterView} i \texttt{UserLoginView} korzystają z generycznych klas widoków.
    \item \textbf{Wzorzec Factory:} Metoda \texttt{generate\_username} dynamicznie generuje nazwę użytkownika.
\end{itemize}

\clearpage %
% Model Address
\subsubsection*{Model \texttt{Address}}
\textbf{Opis:}  
Model \texttt{Address} przechowuje informacje o adresach użytkowników w systemie. Każdy adres przypisany jest do konkretnego użytkownika i może być oznaczony jako domyślny.

\paragraph{Atrybuty:}
\begin{itemize}
    \item \texttt{user}: \texttt{ForeignKey} – relacja z modelem \texttt{User}.
    \begin{itemize}
        \item \texttt{on\_delete=models.CASCADE}: Określa, co zrobić z rekordami \texttt{Address}, gdy rekord użytkownika zostanie usunięty.  
        Wartość \texttt{CASCADE} oznacza, że usunięcie użytkownika spowoduje usunięcie wszystkich powiązanych z nim adresów.
        \item \texttt{related\_name='addresses'}: Umożliwia odwołanie się do wszystkich adresów użytkownika za pomocą \texttt{user.addresses} w zapytaniach Django ORM.
    \end{itemize}
    \item \texttt{street}: \texttt{CharField} (max. 255 znaków) – ulica.
    \item \texttt{city}: \texttt{CharField} (max. 100 znaków) – miasto.
    \item \texttt{postal\_code}: \texttt{CharField} (max. 20 znaków) – kod pocztowy.
    \item \texttt{country}: \texttt{CharField} (max. 100 znaków) – kraj.
    \item \texttt{is\_default}: \texttt{BooleanField} – flaga oznaczająca, czy adres jest domyślny (domyślnie: \texttt{False}).
\end{itemize}


\paragraph{Metody:}
\begin{itemize}
    \item \texttt{get\_address(self)}  
        \begin{itemize}
            \item \textbf{Opis:} Zwraca pełny adres w formie łańcucha tekstowego.
            \item \textbf{Kod:}
            \begin{lstlisting}[language=Python, caption=Metoda get\_address w modelu Address]
def get_address(self):
    return f"{self.street}, {self.city}, {self.country}"
            \end{lstlisting}
        \end{itemize}
    \item \texttt{\_\_str\_\_(self)}  
        \begin{itemize}
            \item \textbf{Opis:} Zwraca reprezentację tekstową obiektu \texttt{Address}.
            \item \textbf{Kod:}
            \begin{lstlisting}[language=Python, caption=Metoda \_\_str\_\_ w modelu Address]
def __str__(self):
    return f"{self.street}, {self.city}, {self.country} ({self.user.email})"
            \end{lstlisting}
        \end{itemize}
\end{itemize}

\subsubsection*{Formularz \texttt{UserAddressForm}}
\textbf{Opis:}  
Formularz pozwalający użytkownikom na wprowadzanie i edycję adresów.

\paragraph{Atrybuty:}
\begin{itemize}
    \item \texttt{fields}: Lista pól formularza: \texttt{street}, \texttt{city}, \texttt{postal\_code}, \texttt{country}, \texttt{is\_default}.
    \item \texttt{widgets}: Niestandardowe widżety dla pól, np. \texttt{TextInput} dla pól tekstowych i \texttt{CheckboxInput} dla pola \texttt{is\_default}.
    \item \texttt{labels}: Etykieta dla pola \texttt{is\_default}: \texttt{"Ustaw jako domyślny adres"}.
\end{itemize}

\paragraph{Walidacja:}
\begin{itemize}
    \item \texttt{clean(self)}  
        \begin{itemize}
            \item \textbf{Opis:} Sprawdza, czy wszystkie wymagane pola zostały poprawnie wypełnione.
            \item \textbf{Kod:}
            \begin{lstlisting}[language=Python, caption=Walidacja formularza UserAddressForm]
def clean(self):
    cleaned_data = super().clean()
    if not cleaned_data.get('street'):
        self.add_error('street', "Ulica jest wymagana.")
    if not cleaned_data.get('city'):
        self.add_error('city', "Miasto jest wymagane.")
    if not cleaned_data.get('postal_code'):
        self.add_error('postal_code', "Kod pocztowy jest wymagany.")
    if not cleaned_data.get('country'):
        self.add_error('country', "Kraj jest wymagany.")
    return cleaned_data
            \end{lstlisting}
        \end{itemize}
\end{itemize}

\paragraph{\texttt{UserAddressCreationView}}
\vspace{0.5em}
\textbf{Opis:} Widok umożliwiający użytkownikowi dodanie nowego adresu dostawy. \\
\textbf{Szablon:} \texttt{add\_address.html} \\
(szczegółowo opisany w sekcji \ref{sec:add_address_template}). \\
\vspace{0.5em}
\textbf{Działanie:}
\begin{itemize}
    \item Pobiera dane z formularza \texttt{UserAddressForm} i zapisuje je w bazie danych.
    \item Jeżeli użytkownik zaznaczy opcję ustawienia adresu jako domyślnego, wszystkie inne adresy użytkownika są automatycznie oznaczane jako niedomyślne.
    \item Po pomyślnym dodaniu adresu użytkownik jest przekierowywany na stronę wyboru adresu (\texttt{address\_selection.html}).
    \item Wyświetla komunikat o powodzeniu operacji.
\end{itemize}

\textbf{Główne metody:}
\begin{itemize}
    \item \texttt{form\_valid(self, form)}:
    \begin{itemize}
        \item Obsługuje poprawne przesłanie formularza.
        \item Kod:
        \begin{lstlisting}[language=Python, caption=Metoda \texttt{form\_valid} w \texttt{UserAddressCreationView}]
def form_valid(self, form):
    address = form.save(commit=False)
    address.user = self.request.user

    if form.cleaned_data.get('is_default'):
        Address.objects.filter(user=self.request.user, is_default=True).update(is_default=False)
        address.is_default = True

    address.save()
    messages.success(self.request, f"Adres {address.street} zostal zapisany.")
    return super().form_valid(form)
        \end{lstlisting}
    \item \textbf{Działanie:}
    \begin{itemize}
        \item Tworzy nowy adres powiązany z użytkownikiem.
        \item Obsługuje ustawianie adresu jako domyślnego.
        \item Przekazuje komunikaty sukcesu.
    \end{itemize}
    \end{itemize}
    \item \texttt{get\_context\_data(self, **kwargs)}:
    \begin{itemize}
        \item Generuje dynamiczne pola formularza dla \texttt{add\_address.html}.
    \end{itemize}
\end{itemize}

\paragraph{\texttt{AddressSelectionView}}
\textbf{Opis:} Widok umożliwiający użytkownikowi wybór adresu dostawy spośród zapisanych adresów.  
\textbf{Szablon:} \texttt{address\_selection.html} (szczegółowo opisany w sekcji \ref{sec:address_selection_template}).  
\textbf{Działanie:}
\begin{itemize}
    \item Wyświetla listę adresów użytkownika w formie opcji do wyboru.
    \item Pozwala użytkownikowi oznaczyć adres jako domyślny.
    \item Jeżeli użytkownik nie ma zapisanych adresów, przekierowuje go do widoku dodawania nowego adresu.
    \item Po zatwierdzeniu wyboru użytkownik jest przekierowywany do metody płatności (\texttt{payment\_form.html}).
\end{itemize}
\textbf{Główne metody:}
\begin{itemize}
    \item \texttt{get(self, request, *args, **kwargs)}:
    \begin{itemize}
        \item Pobiera wszystkie adresy użytkownika.
        \item Oznacza adres domyślny, jeśli taki istnieje.
        \item Kod:
        \begin{lstlisting}[language=Python, caption=Metoda \texttt{get} w \texttt{AddressSelectionView}]
def get(self, request, *args, **kwargs):
    user_addresses = Address.objects.filter(user=request.user)

    if not user_addresses.exists():
        messages.info(request, "Nie masz jeszcze zapisanych adresow. Dodaj nowy adres.")
        return redirect('add_address')

    default_address = user_addresses.filter(is_default=True).first()
    context = {
        'addresses': user_addresses,
        'default_address_id': default_address.id if default_address else None,
    }
    return render(request, self.template_name, context)
        \end{lstlisting}
    \item \textbf{Działanie:}
    \begin{itemize}
        \item Przekazuje listę adresów użytkownika do szablonu.
        \item Obsługuje brak adresów, wyświetlając komunikat i przekierowując użytkownika do dodania nowego adresu.
    \end{itemize}
    \end{itemize}
    \item \texttt{post(self, request, *args, **kwargs)}:
    \begin{itemize}
        \item Umożliwia użytkownikowi wybór domyślnego adresu.
        \item Kod:
        \begin{lstlisting}[language=Python, caption=Metoda \texttt{post} w \texttt{AddressSelectionView}]
def post(self, request, *args, **kwargs):
    selected_address_id = request.POST.get('selected_address')

    if selected_address_id:
        Address.objects.filter(user=request.user, is_default=True).update(is_default=False)
        Address.objects.filter(id=selected_address_id, user=request.user).update(is_default=True)

        messages.success(request, "Adres zostal zapisany.")
        return redirect('payment_form')

    messages.error(request, "Prosze wybrac adres dostawy.")
    return redirect('address_selection')
        \end{lstlisting}
    \item \textbf{Działanie:}
    \begin{itemize}
        \item Oznacza wybrany adres jako domyślny.
        \item Przekazuje użytkownika do metody płatności.
    \end{itemize}
    \end{itemize}
\end{itemize}

\subsubsection*{Szablony użytkownika}

\paragraph{\texttt{add\_address.html}}
\label{sec:add_address_template}
Szablon umożliwiający dodanie nowego adresu użytkownika.  
\textbf{Działanie:}
\begin{itemize}
    \item Formularz umożliwia użytkownikowi wprowadzenie danych adresowych, takich jak ulica, miasto, kod pocztowy i kraj.
    \item Opcjonalnie użytkownik może oznaczyć adres jako domyślny.
    \item Przyciski nawigacyjne pozwalają zapisać adres lub powrócić do poprzedniego widoku.
\end{itemize}
\textbf{Kod szablonu:}
\begin{lstlisting}[language=HTML, caption=Szablon add\_address.html]
<form method="post">
    {% csrf_token %}
    {% for field in form_fields %}
        <div class="form-group">
            <label for="{{ field.name }}" class="form-label">{{ field.label }}:</label>
            <input type="text" id="{{ field.name }}" name="{{ field.name }}" class="form-input"
                placeholder="{{ field.placeholder }}" required>
        </div>
    {% endfor %}
    <div class="form-group">
        <label>
            <input type="checkbox" id="is_default" name="is_default" class="form-checkbox">
            Ustaw jako domyslny adres
        </label>
    </div>
    <div class="card">
        <div class="card-body d-flex justify-content-between align-items-center">
            <a href="{% url 'cart_detail' %}"
               class="form-button form-button-secondary">Powrot</a>
            <button type="submit" class="btn proceed-button">Zapisz adres</button>
        </div>
    </div>
</form>
\end{lstlisting}

\paragraph{\texttt{address\_selection.html}}
\label{sec:address_selection_template}
Szablon umożliwiający wybór istniejącego adresu dostawy.  
\textbf{Działanie:}
\begin{itemize}
    \item Wyświetla listę zapisanych adresów użytkownika jako opcje do wyboru.
    \item Oznacza domyślny adres, jeśli istnieje.
    \item Umożliwia zapisanie wybranego adresu jako domyślnego.
    \item Przycisk nawigacyjny pozwala dodać nowy adres.
\end{itemize}
\textbf{Kod szablonu:}
\begin{lstlisting}[language=HTML, caption=Szablon address\_selection.html]
<form method="post">
    {% csrf_token %}
    {% for address in addresses %}
        <div class="address-card-wrapper {% if address.id == default_address_id %}address-default{% endif %}">
            <input type="radio" name="selected_address" value="{{ address.id }}" id="address-{{ address.id }}"
                   class="address-card-radio" {% if address.id == default_address_id %}checked{% endif %}>
            <label for="address-{{ address.id }}" class="address-card-label">
                <div class="address-card-content">
                    <p><strong>{{ address.street }}</strong></p>
                    <p>{{ address.city }}, {{ address.postal_code }}</p>
                    <p>{{ address.country }}</p>
                    {% if address.id == default_address_id %}
                        <span class="address-default-badge">Domyslny</span>
                    {% endif %}
                </div>
            </label>
        </div>
    {% endfor %}
    <div class="card">
        <div class="card-body d-flex justify-content-between align-items-center">
            <a href="{% url 'add_address' %}" class="form-button form-button-secondary">Dodaj nowy adres</a>
            <button type="submit" class="btn proceed-button">Zatwierdz adres</button>
        </div>
    </div>
</form>
<script src="../static/js/manage_address_selection.js"></script>
\end{lstlisting}





\subsubsection*{Skrypty JavaScript}

\paragraph{\texttt{manage.address\_selection.js}}
Skrypt odpowiedzialny za obsługę interakcji użytkownika z widokiem wyboru adresu dostawy.  
\textbf{Działanie:}
\begin{itemize}
    \item Obsługuje podświetlanie aktywnej opcji adresu przy kliknięciu na kartę adresu.
    \item Sprawdza, czy użytkownik wybrał adres przed wysłaniem formularza – jeżeli nie, wyświetla komunikat o konieczności wyboru adresu.
\end{itemize}

\textbf{Kod skryptu:}
\begin{lstlisting}[language=JavaScript, caption=Skrypt manage.address\_choice.js]
document.addEventListener('DOMContentLoaded', function () {
    const addressCards = document.querySelectorAll('.address-card');
    const form = document.getElementById('address-form');

    addressCards.forEach(card => {
        card.addEventListener('click', () => {
            addressCards.forEach(c => c.classList.remove('active'));
            card.classList.add('active');
        });
    });

    form.addEventListener('submit', function (event) {
        const selectedAddress = document.querySelector('input[name="selected_address"]:checked');
        if (!selectedAddress) {
            event.preventDefault();
            alert('Prosze wybrac adres dostawy.');
        }
    });
});
\end{lstlisting}


% 
% Model PaymentMethod
% 
\subsubsection{Model \texttt{PaymentMethod}}

\textbf{Opis:}  
Model \texttt{PaymentMethod} reprezentuje informacje o metodach płatności dostępnych dla użytkowników systemu. Pozwala na przechowywanie szczegółów dotyczących różnych metod płatności, takich jak karta kredytowa, Blik czy płatność za pobraniem. Model jest powiązany z użytkownikiem za pomocą relacji \texttt{ForeignKey}.

\textbf{Pola w modelu \texttt{PaymentMethod}:}
\begin{itemize}
    \item \texttt{user}: \texttt{ForeignKey} – odniesienie do modelu \texttt{User}, określające, do którego użytkownika należy metoda płatności. Relacja jest typu \texttt{CASCADE}, co oznacza, że usunięcie użytkownika powoduje usunięcie jego metod płatności.
    \item \texttt{payment\_method}: \texttt{CharField} – określa wybraną metodę płatności. Dostępne opcje to:
    \begin{itemize}
        \item \texttt{karta} – Karta kredytowa/debetowa,
        \item \texttt{blik} – Blik,
        \item \texttt{za\_pobraniem} – Płatność za pobraniem.
    \end{itemize}
    \item \texttt{card\_number}: \texttt{CharField} – numer karty płatniczej, wymagany, jeśli metoda płatności to \texttt{karta}. Maksymalna długość: 16 znaków.
    \item \texttt{expiration\_date}: \texttt{CharField} – data ważności karty w formacie MM/YY, wymagana dla \texttt{karta}. Maksymalna długość: 5 znaków.
    \item \texttt{cvv}: \texttt{CharField} – kod CVV karty płatniczej, wymagany dla \texttt{karta}. Maksymalna długość: 4 znaki.
    \item \texttt{blik\_code}: \texttt{CharField} – kod Blik, wymagany, jeśli metoda płatności to \texttt{blik}. Maksymalna długość: 6 znaków.
\end{itemize}

\textbf{Metody modelu:}
\begin{itemize}
    \item \texttt{get\_payment\_method(self)}:
    \begin{itemize}
        \item \textbf{Opis:} Zwraca nazwę wybranej metody płatności na podstawie pola \texttt{payment\_method}. Jeśli metoda jest nieznana, zwracana jest wartość \texttt{Nieznana metoda płatności}.
        \item \textbf{Przykład:}
        \begin{lstlisting}[language=Python]
payment = PaymentMethod.objects.get(id=1)
print(payment.get_payment_method())  # Output: "Karta kredytowa/debetowa"
        \end{lstlisting}
    \end{itemize}
    \item \texttt{\_\_str\_\_(self)}:
    \begin{itemize}
        \item \textbf{Opis:} Zwraca czytelną reprezentację obiektu w formacie: \texttt{<metoda\_płatności> for <nazwa\_użytkownika>}.
        \item \textbf{Przykład:}
        \begin{lstlisting}[language=Python]
payment = PaymentMethod.objects.get(id=1)
print(payment)  # Output: "karta for johndoe"
        \end{lstlisting}
    \end{itemize}
\end{itemize}

\subsubsection*{Formularze związane z modelem}

\paragraph{Formularz wyboru metody płatności (\texttt{PaymentMethodForm})}
\begin{itemize}
    \item \textbf{Opis:} Formularz umożliwiający użytkownikowi wybór i konfigurację metody płatności.
    \item \textbf{Pola:}
    \begin{itemize}
        \item \texttt{payment\_method}, \texttt{card\_number}, \texttt{expiration\_date}, \texttt{cvv}, \texttt{blik\_code}.
    \end{itemize}
    \item \textbf{Walidacja:}
    \begin{itemize}
        \item Dla metody \texttt{karta}: \texttt{card\_number}, \texttt{expiration\_date}, \texttt{cvv} są wymagane.
        \item Dla metody \texttt{blik}: brak dodatkowych wymagań.
    \end{itemize}
\end{itemize}

\subsubsection*{Widoki związane z modelem}

\paragraph{\texttt{PaymentMethodView}}
\begin{itemize}
    \item \textbf{Opis:} Widok umożliwiający użytkownikom wybór i zapisanie metody płatności.
    \item \textbf{Atrybuty:}
    \begin{itemize}
        \item \texttt{template\_name}: \texttt{"cart\_order/payment.html"}.
        \item \texttt{form\_class}: \texttt{PaymentMethodForm}.
    \end{itemize}
    \item \textbf{Metody:}
    \begin{itemize}
        \item \texttt{form\_valid(self, form)}:
        \begin{itemize}
            \item \textbf{Opis:} Obsługuje poprawne przesłanie formularza. Zapisuje metodę płatności i przekierowuje użytkownika na odpowiednią stronę w zależności od wybranej metody.
        \end{itemize}
        \item \texttt{form\_invalid(self, form)}:
        \begin{itemize}
            \item \textbf{Opis:} Obsługuje niepoprawne przesłanie formularza, wyświetlając błędy walidacji.
        \end{itemize}
    \end{itemize}
\end{itemize}


\paragraph{\texttt{BlikCodeView}}
\begin{itemize}
    \item \textbf{Opis:} Widok obsługujący wprowadzanie kodu Blik przez użytkownika podczas finalizacji zamówienia.
    \item \textbf{Kod widoku:}
\begin{lstlisting}[language=Python, caption=Kod widoku BlikCodeView]
class BlikCodeView(CategoriesMixin, LoginRequiredMixin, View):
    template_name = "cart_order/blik_payment.html"

    def get(self, request, *args, **kwargs):
        context = self.get_context_data()
        return render(request, self.template_name, context)

    def post(self, request, *args, **kwargs):
        blik_code = request.POST.get('blik_code')

        if not blik_code or len(blik_code) != 6 or not blik_code.isdigit():
            messages.error(request, "Nieprawidlowy kod Blik. Sprobuj ponownie.")
            return render(request, self.template_name)

        # Zapisz kod Blik w sesji
        order_session = request.session.get('order_session', {})
        order_session['blik_code'] = blik_code
        request.session['order_session'] = order_session
        request.session.modified = True

        messages.success(request, "Platnosc Blik zostala zatwierdzona.")
        return redirect('create_order')
\end{lstlisting}

    \item \textbf{Wyjaśnienie funkcji:}
    \begin{itemize}
        \item \texttt{get(self, request, *args, **kwargs)}:
        \begin{itemize}
            \item Wyświetla stronę do wprowadzenia kodu Blik.
            \item Tworzy kontekst za pomocą \texttt{get\_context\_data}.
            \item Renderuje szablon \texttt{blik\_payment.html}.
        \end{itemize}
        \item \texttt{post(self, request, *args, **kwargs)}:
        \begin{itemize}
            \item Przetwarza kod Blik wprowadzony przez użytkownika.
            \item Sprawdza poprawność kodu:
            \begin{itemize}
                \item Kod musi mieć dokładnie 6 cyfr.
                \item Kod może zawierać tylko cyfry.
            \end{itemize}
            \item W przypadku błędu:
            \begin{itemize}
                \item Wyświetla komunikat o błędzie.
                \item Renderuje ponownie stronę z formularzem.
            \end{itemize}
            \item Jeśli kod jest poprawny:
            \begin{itemize}
                \item Zapisuje kod Blik w sesji.
                \item Przekierowuje na stronę \texttt{create\_order}.
            \end{itemize}
        \end{itemize}
    \end{itemize}
\end{itemize}


\subsubsection*{Endpointy związane z modelem}
\begin{itemize}
    \item \texttt{/payment/} – wybór metody płatności (\texttt{PaymentMethodView}).
    \item \texttt{/blik-payment/} – wprowadzenie kodu Blik. (\texttt{BlikCodeView})
\end{itemize}

\subsubsection*{Szablony związane z modelem}

\paragraph{\texttt{payment.html}}
\begin{itemize}
    \item \textbf{Opis:} Formularz wyboru metody płatności z dynamicznym ukrywaniem pól dla \texttt{karta} i \texttt{blik}. Zawiera logikę JavaScript do zmiany widoczności pól na podstawie wybranej metody płatności.
\end{itemize}

\begin{lstlisting}[language=HTML, caption=Szablon payment.html]
<form method="post" action="{% url 'payment_form' %}">
    {% csrf_token %}
    <div class="form-group">
        <label for="id_payment_method" class="form-label">Wybierz metode platnosci</label>
        {{ form.payment_method|add_class:"form-select" }}
    </div>
    <div id="card-fields" class="form-group" style="display: none;">
        <div class="mb-2">
            <label for="id_card_number" class="form-label">Numer karty</label>
            {{ form.card_number|add_class:"form-input" }}
        </div>
        <div class="mb-2">
            <label for="id_expiration_date" class="form-label">Data waznosci</label>
            {{ form.expiration_date|add_class:"form-input" }}
        </div>
        <label for="id_cvv" class="form-label">CVV</label>
        {{ form.cvv|add_class:"form-input" }}
    </div>
    <div class="card">
        <div class="card-body d-flex justify-content-between align-items-center">
            <button type="submit" class="btn proceed-button">Zatwierdz platnosc</button>
        </div>
    </div>
</form>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const paymentMethodSelect = document.querySelector('#id_payment_method');
        const cardFields = document.querySelector('#card-fields');

        function updateFields() {
            const selectedMethod = paymentMethodSelect.value;
            cardFields.style.display = selectedMethod === 'karta' ? 'block' : 'none';
        }

        paymentMethodSelect.addEventListener('change', updateFields);
        updateFields(); // Initial update
    });
</script>
\end{lstlisting}

\paragraph{\texttt{blik\_payment.html}}
\begin{itemize}
    \item \textbf{Opis:} Szablon umożliwiający użytkownikowi wprowadzenie kodu Blik.
\end{itemize}

\begin{lstlisting}[language=HTML, caption=Szablon blik_payment.html]
<section class="blik-container">
    <div class="blik-wrapper">
        <div class="blik-header">
            <h2 class="blik-title">Wprowadx kod Blik</h2>
            <p class="blik-description">Aby zatwierdzic platnosc, wprowadz 6-cyfrowy kod wygenerowany w aplikacji mobilnej banku.</p>
        </div>
        <div class="blik-body">
            <form method="post" class="blik-form">
                {% csrf_token %}
                <div class="blik-form-group">
                    <label for="blik_code" class="blik-form-label">Kod Blik</label>
                    <input type="text" id="blik_code" name="blik_code" maxlength="6" class="blik-form-input"
                           placeholder="Wprowadz 6-cyfrowy kod Blik">
                </div>
                <div class="blik-form-actions">
                    <button type="submit" class="blik-submit-btn">Zatwierdz kod</button>
                </div>
            </form>
        </div>
    </div>
</section>
\end{lstlisting}

% 
% Model Product
% 
% 
% Model Product
% 
\subsubsection{Model \texttt{Product}}

\textbf{Opis:}  
Model \texttt{Product} przechowuje informacje o produktach dostępnych w sklepie internetowym, takie jak nazwa, marka, opis, cena, średnia ocena, zdjęcia oraz szczegóły techniczne. Model umożliwia również przypisanie kategorii oraz oznaczenie produktów ulubionych przez użytkowników.

\textbf{Pola w modelu \texttt{Product}:}
\begin{itemize}
    \item \texttt{name}: \texttt{CharField} – nazwa produktu (maksymalnie 100 znaków).
    \item \texttt{brand}: \texttt{CharField} – nazwa marki produktu. Domyślna wartość: \texttt{KMG}.
    \item \texttt{image}: \texttt{ImageField} – główne zdjęcie produktu. Domyślna wartość: \texttt{products/default\_product.png}.
    \item \texttt{description}: \texttt{TextField} – szczegółowy opis produktu.
    \item \texttt{price}: \texttt{DecimalField} – cena produktu z dokładnością do 2 miejsc dziesiętnych.
    \item \texttt{average\_rate}: \texttt{DecimalField} – średnia ocena produktu (opcjonalne).
    \item \texttt{liked\_by}: \texttt{ManyToManyField} – użytkownicy, którzy dodali produkt do ulubionych.
    \item \texttt{categories}: \texttt{ManyToManyField} – przypisane kategorie produktu.
    \item \texttt{product\_details}: \texttt{JSONField} – szczegóły techniczne produktu w formacie JSON.
    \item \texttt{product\_images\_links}: \texttt{JSONField} – dodatkowe zdjęcia produktu w formacie JSON.
\end{itemize}

\textbf{Metody modelu:}
\begin{itemize}
    \item \texttt{\_\_str\_\_(self)}:
    \begin{itemize}
        \item \textbf{Opis:} Zwraca czytelną reprezentację produktu, zawierającą nazwę, markę, opis, cenę i średnią ocenę.
    \end{itemize}
    \item \texttt{clean(self)}:
    \begin{itemize}
        \item \textbf{Opis:} Waliduje, czy plik zdjęcia istnieje w systemie plików.
        \item \textbf{Przykład błędu:} \texttt{ValidationError: "The image default\_product.png does not exist."}
    \end{itemize}
    \item \texttt{update\_average\_rate(self)}:
    \begin{itemize}
        \item \textbf{Opis:} Przelicza i aktualizuje średnią ocenę produktu na podstawie powiązanych ocen.
    \end{itemize}
\end{itemize}

\subsubsection*{Widok szczegółów produktu}

\paragraph{\texttt{ProductDetailView}}
\begin{itemize}
    \item \textbf{Opis:} Widok szczegolow produktu, prezentujacy wszystkie informacje o produkcie, zdjecia, specyfikacje oraz opinie uzytkownikow.
    \item \textbf{Kod widoku:}
\begin{lstlisting}[language=Python, caption=Kod widoku ProductDetailView]
class ProductDetailView(CategoriesMixin, DetailView):
    model = Product
    template_name = 'product_detail.html'
    context_object_name = 'product'

    def get(self, request, *args, **kwargs):
        response = super().get(request, *args, **kwargs)
        product = self.get_object()
        one_hour_ago = timezone.now() - timedelta(hours=1)

        if request.user.is_authenticated:
            if not UserProductVisibility.objects.filter(
                user=request.user,
                product=product,
                view_date__gte=one_hour_ago
            ).exists():
                UserProductVisibility.objects.create(
                    user=request.user, 
                    product=product, 
                    view_date=timezone.now()
                )
        else:
            if 'product_visibility' not in request.session:
                request.session['product_visibility'] = []

            session_entries = request.session['product_visibility']
            if not any(
                entry['product'] == product.id 
                and datetime.fromisoformat(entry['view_date']) >= one_hour_ago
                for entry in session_entries
            ):
                session_entries.append({
                    'product': product.id,
                    'view_date': timezone.now().isoformat()
                })
            request.session.modified = True

        return response

    def get_context_data(self, **kwargs):
        context = super().get_context_data(**kwargs)
        product = self.object
        context['ratings'] = product.ratings.all().order_by('-created_at')
        context['ratings_count'] = product.ratings.count()
        return context
\end{lstlisting}
    \item \textbf{Wyjasnienie funkcji:}
    \begin{itemize}
        \item \texttt{get(self, request, *args, **kwargs)}:
        \begin{itemize}
            \item \textbf{Opis:} Ta metoda jest odpowiedzialna za rejestrowanie widocznosci produktu. Jezeli uzytkownik jest zalogowany, tworzy wpis w bazie danych \texttt{UserProductVisibility}, aby odnotowac, ze produkt zostal ogladany. Jezeli uzytkownik jest anonimowy, zapisuje informacje w sesji.
            \item \textbf{Glowne operacje:}
            \begin{itemize}
                \item Dla zalogowanych uzytkownikow: sprawdza, czy produkt byl ogladany w ciagu ostatniej godziny. Jezeli nie, tworzy nowy wpis w bazie.
                \item Dla anonimowych uzytkownikow: zapisuje informacje o widocznosci produktu w sesji.
            \end{itemize}
        \end{itemize}
        \item \texttt{get\_context\_data(self, **kwargs)}:
        \begin{itemize}
            \item \textbf{Opis:} Dodaje dodatkowe dane do kontekstu szablonu. W szczegolnosci:
            \begin{itemize}
                \item \texttt{ratings}: lista ocen produktu, posortowana malejaco wedlug daty utworzenia.
                \item \texttt{ratings\_count}: liczba ocen produktu.
            \end{itemize}
        \end{itemize}
    \end{itemize}
\end{itemize}


\subsubsection*{Szablony związane z modelem}

\paragraph{\texttt{product\_detail.html}}
\begin{itemize}
    \item \textbf{Opis:} Szablon szczegółów produktu, zawierający elementy takie jak:
    \begin{itemize}
        \item Galeria zdjęć produktu z obsługą karuzeli.
        \item Szczegóły produktu (nazwa, marka, cena, średnia ocena, ulubione).
        \item Specyfikacja techniczna z pola \texttt{product\_details}.
        \item Opinie użytkowników oraz przycisk do edycji opinii.
    \end{itemize}
\end{itemize}

\begin{lstlisting}[language=HTML, caption=Szablon product\_detail.html]
<!-- Fragment szablonu szczegolow produktu -->
<div id="product-detail">
    <div id="productCarousel" class="carousel slide">
        {% for image in product.product_images_links %}
        <div class="carousel-item {% if forloop.first %}active{% endif %}">
            <img src="{{ image }}" class="d-block product-image">
        </div>
        {% endfor %}
    </div>
    <div>
        <h2>{{ product.name }}</h2>
        <p>{{ product.description }}</p>
        <span>{{ product.price }} zl</span>
    </div>
</div>
\end{lstlisting}

\subsubsection*{Skrypt JavaScript dla szczegółów produktu}

\paragraph{\texttt{product\_detail.js}}
\begin{itemize}
    \item \textbf{Opis:} Skrypt odpowiadający za obsługę dynamicznych elementów na stronie szczegółów produktu, takich jak:
    \begin{itemize}
        \item Zarządzanie karuzelą zdjęć.
        \item Obsługa przycisku „Dodaj do ulubionych”.
        \item Dynamiczna edycja opinii użytkownika.
    \end{itemize}
\end{itemize}

\begin{lstlisting}[language=JavaScript, caption=Skrypt product\_detail.js]
// Obsluga karuzeli zdjec
function initializeCarousel() {
    const carousel = document.getElementById('productCarousel');
    // Logika zarzadzania karuzela
}

// Obsluga dodawania do ulubionych
function handleLikeButton(productId) {
    document.getElementById(`like-btn-${productId}`).addEventListener('click', () => {
        // Wysylanie zadania AJAX do API ulubionych
    });
}

// Obsluga edycji opinii
function setupEditReviewModal() {
    const editButtons = document.querySelectorAll('.edit-rating-btn');
    editButtons.forEach(button => {
        button.addEventListener('click', () => {
            // Wyswietlenie modala edycji opinii
        });
    });
}

// Inicjalizacja
document.addEventListener('DOMContentLoaded', () => {
    initializeCarousel();
    setupEditReviewModal();
});
\end{lstlisting}

\textbf{Uwagi:}
\begin{itemize}
    \item Skrypt został podzielony na logiczne funkcje, aby ułatwić jego utrzymanie.
    \item Funkcje mogą być rozszerzane lub integrowane z backendem (np. AJAX dla ulubionych).
\end{itemize}


% 
% Model Category 
% 
\subsubsection{Model \texttt{Category}}

\textbf{Opis:}  
Model \texttt{Category} reprezentuje kategorie produktów w sklepie internetowym. Pozwala na tworzenie hierarchii kategorii poprzez relację nadrzędnych i podrzędnych kategorii.

\textbf{Pola modelu:}
\begin{itemize}
    \item \texttt{name}: \texttt{CharField} – nazwa kategorii, maksymalnie 100 znaków.
    \item \texttt{description}: \texttt{TextField} – opis kategorii.
    \item \texttt{parent}: \texttt{ManyToManyField} – relacja do kategorii nadrzędnych. Pozwala na tworzenie złożonych hierarchii. Ustawienia:
    \begin{itemize}
        \item \texttt{blank=True} – pole opcjonalne.
        \item \texttt{symmetrical=False} – relacja niesymetryczna, aby rozróżnić nadrzędne i podrzędne kategorie.
        \item \texttt{related\_name='subcategories'} – alias do dostępu do kategorii podrzędnych.
    \end{itemize}
\end{itemize}

\textbf{Metadane:}
\begin{itemize}
    \item \texttt{verbose\_name}: \texttt{"Category"} – nazwa w panelu administracyjnym.
    \item \texttt{verbose\_name\_plural}: \texttt{"Categories"} – liczba mnoga w panelu administracyjnym.
\end{itemize}

\textbf{Metody:}
\begin{itemize}
    \item \texttt{\_\_str\_\_}: Zwraca czytelną reprezentację kategorii w formacie: \texttt{"Category: <nazwa>"}.
\end{itemize}


\subsubsection*{Widoki powiązane z kategorią}
\paragraph{\texttt{CategoriesMixin}}
\begin{itemize}
    \item \textbf{Opis:} Mixin, który dodaje listę kategorii nadrzędnych i ich podrzędnych do kontekstu widoków.
    \item \textbf{Kod widoku:}
\begin{lstlisting}[language=Python, caption=Kod widoku CategoriesMixin]
class CategoriesMixin(ContextMixin):
    def get_context_data(self, **kwargs):
        context = super().get_context_data(**kwargs)
        # Pobranie kategorii nadrzednych
        context['categories'] = Category.objects.filter(parent__isnull=True)

        # Sprawdzenie, czy wybrano kategorie
        selected_category_id = self.request.GET.get('category')
        if selected_category_id:
            try:
                selected_category = Category.objects.get(id=selected_category_id)
                # Dodanie podrzednych kategorii do kontekstu
                context['subcategories'] = selected_category.subcategories.all()
                context['selected_category'] = selected_category
            except Category.DoesNotExist:
                context['subcategories'] = None
                context['selected_category'] = None
        else:
            context['subcategories'] = None
            context['selected_category'] = None
        return context
\end{lstlisting}

    \item \textbf{Wyjaśnienie:}
    \begin{itemize}
        \item Pobiera kategorie nadrzędne (\texttt{parent=NULL}).
        \item Jeśli w żądaniu jest przekazana kategoria (\texttt{category}), to:
        \begin{itemize}
            \item Dodaje jej podrzędne kategorie do kontekstu.
            \item Ustawia wybraną kategorię jako \texttt{selected\_category}.
        \end{itemize}
    \end{itemize}
\end{itemize}
\paragraph{\texttt{CategoryProductsView}}
\begin{itemize}
    \item \textbf{Opis:} Widok listy produktów w wybranej kategorii i jej podrzędnych. Obsługuje filtrowanie, sortowanie i paginację.
    \item \textbf{Kod widoku:}
\begin{lstlisting}[language=Python, caption=Kod widoku CategoryProductsView]
class CategoryProductsView(ListView, CategoriesMixin):
    model = Product
    template_name = 'category_products.html'
    context_object_name = 'products'
    paginate_by = 16

    def get_context_data(self, **kwargs):
        context = super().get_context_data(**kwargs)
        category = get_object_or_404(Category, id=self.kwargs['category_id'])
        context['total_products'] = self.get_queryset().count()
        context['liked_products'] = get_liked_products(self.request)
        context['liked_product_ids'] = list(self.get_favorites().values_list('id', flat=True))
        context['min_price'] = self.request.GET.get('min_price', '')
        context['max_price'] = self.request.GET.get('max_price', '')
        context['sort_by'] = self.request.GET.get('sort_by', 'default')
        context['category'] = category
        return context

    def get_queryset(self):
        category = get_object_or_404(Category, id=self.kwargs['category_id'])
        all_categories = [category] + list(category.subcategories.all())
        for subcategory in category.subcategories.all():
            all_categories += list(subcategory.subcategories.all())

        queryset = Product.objects.filter(categories__in=all_categories).distinct()

        # Sortowanie
        sort_by = self.request.GET.get('sort_by')
        if sort_by == 'price_asc':
            queryset = queryset.order_by('price')
        elif sort_by == 'price_desc':
            queryset = queryset.order_by('-price')
        elif sort_by == 'rating_asc':
            queryset = queryset.order_by('average_rate')
        elif sort_by == 'rating_desc':
            queryset = queryset.order_by('-average_rate')
        elif sort_by == 'popularity_asc':
            queryset = queryset.annotate(popularity_count=Count('liked_by')).order_by('popularity_count')
        elif sort_by == 'popularity_desc':
            queryset = queryset.annotate(popularity_count=Count('liked_by')).order_by('-popularity_count')

        # Filtrowanie po cenie
        min_price = self.request.GET.get('min_price')
        max_price = self.request.GET.get('max_price')
        if min_price:
            queryset = queryset.filter(price__gte=min_price)
        if max_price:
            queryset = queryset.filter(price__lte=max_price)

        # Rejestrowanie widocznosci kategorii
        one_hour_ago = timezone.now() - timedelta(hours=1)
        if not max_price and not min_price and not sort_by:
            if self.request.user.is_authenticated:
                if not UserCategoryVisibility.objects.filter(
                    user=self.request.user, category=category, view_date__gte=one_hour_ago
                ).exists():
                    UserCategoryVisibility.objects.create(user=self.request.user, category=category,
                                                          view_date=timezone.now())
            else:
                if 'category_visibility' not in self.request.session:
                    self.request.session['category_visibility'] = []

                session_entries = self.request.session['category_visibility']
                if not any(entry['category'] == category.id and datetime.fromisoformat(entry['view_date']) >= one_hour_ago
                           for entry in session_entries):
                    session_entries.append({
                        'category': category.id,
                        'view_date': timezone.now().isoformat()
                    })

                self.request.session.modified = True
        return queryset
\end{lstlisting}

    \item \textbf{Wyjaśnienie funkcji:}
    \begin{itemize}
        \item \texttt{get\_context\_data()}:
        \begin{itemize}
            \item Dodaje do kontekstu:
            \begin{itemize}
                \item Liczbę produktów w kategorii i podrzędnych.
                \item Listę produktów ulubionych przez użytkownika.
                \item Parametry filtrowania: \texttt{min\_price}, \texttt{max\_price}, \texttt{sort\_by}.
            \end{itemize}
        \end{itemize}
        \item \texttt{get\_queryset()}:
        \begin{itemize}
            \item Pobiera produkty przypisane do wybranej kategorii i jej podrzędnych.
            \item Obsługuje filtrowanie po cenie i sortowanie po wybranym parametrze.
            \item Rejestruje widoczność kategorii dla zalogowanych lub anonimowych użytkowników.
        \end{itemize}
    \end{itemize}
\end{itemize}
\paragraph{Skrypt do obsługi kategorii}
\begin{lstlisting}[language=JavaScript, caption=Skrypt kategorii]
document.addEventListener('DOMContentLoaded', () => {
    const toggleButton = document.getElementById('categories-toggle');
    const categoriesContainer = document.getElementById('header_categories');

    // Rozwijanie i zwijanie menu kategorii
    toggleButton.addEventListener('click', () => {
        const isExpanded = categoriesContainer.classList.toggle('show');
        toggleButton.setAttribute('aria-expanded', isExpanded);
    });

    // Aktualizacja wybranej kategorii
    const updateSelectedCategory = (index) => {
        // Logika zaznaczania wybranej kategorii
    };

    // Obsluga klikniecia poza menu
    document.addEventListener('click', (event) => {
        if (!categoriesContainer.contains(event.target) && event.target !== toggleButton) {
            categoriesContainer.classList.remove('show');
            toggleButton.setAttribute('aria-expanded', false);
        }
    });
});
\end{lstlisting}

\textbf{Opis funkcjonalności:}
\begin{itemize}
    \item Obsługuje rozwijanie i zwijanie menu kategorii.
    \item Umożliwia zaznaczanie wybranej kategorii.
    \item Ukrywa menu, jeśli użytkownik kliknie poza nim.
\end{itemize}


% 
%  Model Cart | CartItem
% 

\subsubsection{Model \texttt{Cart} i \texttt{CartItem}}

\textbf{Opis:}  
Model \texttt{Cart} reprezentuje koszyk użytkownika, który przechowuje produkty dodane do zakupu. Model \texttt{CartItem} przechowuje szczegóły każdego elementu w koszyku, takie jak produkt, ilość i cena.

\textbf{Pola w modelu \texttt{Cart}:}
\begin{itemize}
    \item \texttt{user}: \texttt{ForeignKey} – odniesienie do użytkownika, do którego należy koszyk. Pole opcjonalne dla anonimowych użytkowników.
    \item \texttt{created\_at}: \texttt{DateTimeField} – data i czas utworzenia koszyka.
    \item \texttt{updated\_at}: \texttt{DateTimeField} – data i czas ostatniej aktualizacji koszyka.
\end{itemize}

\textbf{Pola w modelu \texttt{CartItem}:}
\begin{itemize}
    \item \texttt{cart}: \texttt{ForeignKey} – odniesienie do koszyka, w którym znajduje się dany produkt.
    \item \texttt{product}: \texttt{ForeignKey} – odniesienie do modelu \texttt{Product}.
    \item \texttt{quantity}: \texttt{PositiveIntegerField} – liczba sztuk danego produktu w koszyku (domyślnie 1).
    \item \texttt{added\_at}: \texttt{DateTimeField} – data i czas dodania produktu do koszyka.
\end{itemize}

\textbf{Metody:}
\begin{itemize}
    \item \texttt{Cart.get\_total\_price()} – Zwraca łączną wartość koszyka na podstawie cen produktów i ich ilości.
    \item \texttt{CartItem.get\_total\_price()} – Oblicza cenę za dany produkt w koszyku na podstawie jego ilości.
\end{itemize}


\subsubsection*{Widoki powiązane z koszykiem}


\paragraph{\texttt{CartDetailView}}
\begin{itemize}
    \item \textbf{Opis:} Widok szczegółowy koszyka, wyświetlający produkty, ich ilości oraz całkowitą wartość koszyka.
    \item \textbf{Kod widoku:}
\begin{lstlisting}[language=Python, caption=Kod widoku CartDetailView]
class CartDetailView(CategoriesMixin, ListView):
    template_name = 'cart_order/cart.html'
    context_object_name = 'cart_items'

    def get_queryset(self):
        # Pobieranie koszyka zalogowanego uzytkownika lub anonimowego
        if self.request.user.is_authenticated:
            cart, created = Cart.objects.get_or_create(user=self.request.user)
        else:
            cart_id = self.request.session.get('cart_id')
            cart = Cart.objects.filter(id=cart_id, user=None).first() if cart_id else None

        return CartItem.objects.filter(cart=cart) if cart else CartItem.objects.none()

    def get_context_data(self, **kwargs):
        context = super().get_context_data(**kwargs)
        cart_items = context['cart_items']
        total_price = sum(item.product.price * item.quantity for item in cart_items)
        context.update({
            'total_quantity': sum(item.quantity for item in cart_items),
            'total_amount': total_price,
        })
        return context
\end{lstlisting}

    \item \textbf{Wyjaśnienie:}
    \begin{itemize}
        \item \texttt{get\_queryset()} – Pobiera koszyk użytkownika lub anonimowego (na podstawie sesji) i zwraca wszystkie elementy koszyka.
        \item \texttt{get\_context\_data()} – Oblicza całkowitą ilość i wartość produktów w koszyku.
    \end{itemize}
\end{itemize}

\paragraph{\texttt{AddToCartView}}
\begin{itemize}
    \item \textbf{Opis:} Widok umożliwiający dodanie produktu do koszyka.
    \item \textbf{Kod widoku:}
\begin{lstlisting}[language=Python, caption=Kod widoku AddToCartView]
class AddToCartView(CategoriesMixin, View):
    def post(self, request, product_id):
        product = get_object_or_404(Product, id=product_id)
        quantity = int(request.POST.get('quantity', 1))

        if request.user.is_authenticated:
            cart, created = Cart.objects.get_or_create(user=request.user)
        else:
            cart_id = request.session.get('cart_id')
            cart, created = Cart.objects.get_or_create(id=cart_id, user=None) if cart_id else Cart.objects.create(user=None)
            request.session['cart_id'] = cart.id

        cart_item, created = CartItem.objects.get_or_create(cart=cart, product=product)
        cart_item.quantity += quantity if not created else quantity
        cart_item.save()

        return JsonResponse({'success': True, 'product_id': product_id, 'quantity': cart_item.quantity})
\end{lstlisting}

    \item \textbf{Wyjaśnienie:}
    \begin{itemize}
        \item Pobiera produkt na podstawie \texttt{product\_id}.
        \item Dodaje produkt do koszyka użytkownika (lub anonimowego).
        \item Zwiększa ilość produktu, jeśli już istnieje w koszyku.
    \end{itemize}
\end{itemize}

\paragraph{\texttt{RemoveFromCartView}}
\begin{itemize}
    \item \textbf{Opis:} Widok usuwający produkt z koszyka.
    \item \textbf{Kod widoku:}
\begin{lstlisting}[language=Python, caption=Kod widoku RemoveFromCartView]
class RemoveFromCartView(CategoriesMixin, View):
    def post(self, request, product_id):
        product = get_object_or_404(Product, id=product_id)
        cart = Cart.objects.filter(user=request.user).first() if request.user.is_authenticated else Cart.objects.filter(id=request.session.get('cart_id')).first()
        if not cart:
            return JsonResponse({'success': False, 'message': 'Cart not found'})

        cart_item = get_object_or_404(CartItem, cart=cart, product=product)
        cart_item.delete()

        return JsonResponse({'success': True, 'product_id': product_id})
\end{lstlisting}

    \item \textbf{Wyjaśnienie:}
    \begin{itemize}
        \item Usuwa produkt z koszyka użytkownika lub anonimowego.
        \item Zwraca odpowiedź JSON z wynikiem operacji.
    \end{itemize}
\end{itemize}

\paragraph{\texttt{UpdateCartItemView}}
\begin{itemize}
    \item \textbf{Opis:} Widok aktualizujący ilość produktu w koszyku.
    \item \textbf{Kod widoku:}
\begin{lstlisting}[language=Python, caption=Kod widoku UpdateCartItemView]
class UpdateCartItemView(CategoriesMixin, View):
    def post(self, request, product_id):
        action = request.POST.get('action')
        quantity = request.POST.get('quantity')
        product = get_object_or_404(Product, id=product_id)
        cart = Cart.objects.filter(user=request.user).first() if request.user.is_authenticated else Cart.objects.filter(id=request.session.get('cart_id')).first()

        cart_item = get_object_or_404(CartItem, cart=cart, product=product)
        if quantity:
            cart_item.quantity = max(1, int(quantity))
        elif action == 'increase':
            cart_item.quantity += 1
        elif action == 'decrease' and cart_item.quantity > 1:
            cart_item.quantity -= 1
        cart_item.save()

        return JsonResponse({'success': True, 'product_id': product_id, 'quantity': cart_item.quantity})
\end{lstlisting}

    \item \textbf{Wyjaśnienie:}
    \begin{itemize}
        \item Aktualizuje ilość produktu na podstawie żądania.
        \item Obsługuje zarówno ręczne zmiany, jak i operacje \texttt{increase}/\texttt{decrease}.
    \end{itemize}
\end{itemize}


\subsubsection{Skrypt obsługujący koszyk}

\textbf{Opis:}  
Skrypt obsługuje operacje na koszyku, takie jak dodawanie produktów, aktualizowanie ilości oraz usuwanie.

\textbf{Funkcje w skrypcie:}
\begin{itemize}
    \item \texttt{remove-from-cart} – Usuwa produkt z koszyka.
    \item \texttt{update-cart-item} – Aktualizuje ilość produktu w koszyku (przyciski + i -).
    \item \texttt{updateTotalAmount} – Przelicza całkowitą wartość koszyka.
\end{itemize}

\subsubsection{Szablon \texttt{cart.html}}

\textbf{Opis:}  
Szablon wyświetla szczegóły koszyka użytkownika, takie jak lista produktów, ich ilości, ceny i całkowitą wartość.

\textbf{Kluczowe elementy:}
\begin{itemize}
    \item \texttt{cart\_items} – Lista produktów w koszyku.
    \item \texttt{item-quantity} – Pole do zmiany ilości produktu.
    \item \texttt{remove-from-cart} – Przycisk do usunięcia produktu.
    \item \texttt{total-amount-box} – Pole wyświetlające całkowitą wartość koszyka.
\end{itemize}



\subsubsection{Skrypt obsługujący koszyk}

\textbf{Opis:}  
Skrypt \texttt{manage\_cart.js} zarządza interakcjami użytkownika z koszykiem, takimi jak dodawanie produktów, usuwanie produktów oraz aktualizowanie ich ilości. Skrypt komunikuje się z backendem za pomocą żądań AJAX oraz dynamicznie aktualizuje dane w widoku koszyka bez przeładowywania strony.

\textbf{Endpointy związane z funkcjonalnością:}
\begin{itemize}
    \item \texttt{/add-to-cart/<int:product\_id>/} – Dodawanie produktu do koszyka.
    \item \texttt{/remove-from-cart/<int:product\_id>/} – Usuwanie produktu z koszyka.
    \item \texttt{/update-cart-item/<int:product\_id>/} – Aktualizowanie ilości produktu w koszyku.
\end{itemize}

\textbf{Funkcje w skrypcie:}

\paragraph{Usuwanie produktów z koszyka (\texttt{remove-from-cart})}
\begin{itemize}
    \item \textbf{Opis:}  
    Funkcja obsługuje usuwanie produktu z koszyka. Wysyła żądanie POST do endpointu \texttt{/remove-from-cart/<int:product\_id>/} i po pomyślnym usunięciu aktualizuje widok koszyka.
    \item \textbf{Kod:}
\begin{lstlisting}[language=JavaScript, caption=Kod funkcji remove-from-cart]
$('.remove-from-cart').click(function (event) {
    event.preventDefault();
    const productId = $(this).data('product-id');
    const card = $(this).closest('.card');

    $.ajax({
        url: '/remove-from-cart/' + productId + '/',
        type: 'POST',
        headers: { 'X-CSRFToken': csrftoken },
        success: function (response) {
            if (response.success) {
                card.remove(); // Usuwa produkt z widoku
                updateTotalAmount(); 
            }
        }
    });
});
\end{lstlisting}
    \item \textbf{Powiązane elementy w szablonie:}
    \begin{itemize}
        \item Przycisk \texttt{.remove-from-cart} w \texttt{cart.html}.
        \item Pole \texttt{total-amount-box}, które jest dynamicznie aktualizowane.
    \end{itemize}
\end{itemize}

\paragraph{Aktualizacja ilości produktów (\texttt{update-cart-item})}
\begin{itemize}
    \item \textbf{Opis:}  
    Funkcja aktualizuje ilość wybranego produktu w koszyku. Obsługuje zarówno ręczne wprowadzanie ilości, jak i przyciski zwiększania/zwiększania ilości.
    \item \textbf{Kod:}
\begin{lstlisting}[language=JavaScript, caption=Kod funkcji update-cart-item]
$('.update-cart-item').click(function (event) {
    event.preventDefault();
    const productId = $(this).data('product-id');
    const action = $(this).data('action');
    const quantityInput = $(this).siblings('.item-quantity');
    let quantity = parseInt(quantityInput.val());

    if (action === 'increase') {
        quantity += 1;
    } else if (action === 'decrease' && quantity > 1) {
        quantity -= 1;
    }

    quantityInput.val(quantity); // Aktualizuje widok
    updateTotalPrice(productId, quantity);

    $.ajax({
        url: '/update-cart-item/' + productId + '/',
        type: 'POST',
        headers: { 'X-CSRFToken': csrftoken },
        data: { action: action },
        success: function (response) {
            if (response.success) {
                updateTotalAmount(); 
            }
        }
    });
});
\end{lstlisting}
    \item \textbf{Powiązane elementy w szablonie:}
    \begin{itemize}
        \item Przycisk \texttt{.update-cart-item} w \texttt{cart.html}.
        \item Pole \texttt{item-quantity}, gdzie użytkownik może ręcznie zmieniać ilość.
    \end{itemize}
\end{itemize}

\paragraph{Aktualizacja całkowitej wartości koszyka (\texttt{updateTotalAmount})}
\begin{itemize}
    \item \textbf{Opis:}  
    Funkcja oblicza całkowitą wartość koszyka na podstawie ilości i ceny produktów. Jest wywoływana po każdej zmianie w koszyku.
    \item \textbf{Kod:}
\begin{lstlisting}[language=JavaScript, caption=Kod funkcji updateTotalAmount]
function updateTotalAmount() {
    let total = 0;

    $('.item-total-price').each(function () {
        const unitPrice = parseFloat($(this).data('unit-price'));
        const quantity = parseInt($(this).closest('.row').find('.item-quantity').val());
        total += unitPrice * quantity;
    });

    $('.total-amount-box').text(`Calkowita kwota: ${total.toFixed(2)} zl`);
}
\end{lstlisting}
    \item \textbf{Powiązane elementy w szablonie:}
    \begin{itemize}
        \item Pole \texttt{total-amount-box}, wyświetlające łączną wartość koszyka.
        \item Elementy \texttt{item-total-price}, reprezentujące ceny jednostkowe produktów.
    \end{itemize}
\end{itemize}

\paragraph{Dodawanie produktów do koszyka (\texttt{add-to-cart})}
\begin{itemize}
    \item \textbf{Opis:}  
    Funkcja dodaje wybrany produkt do koszyka, wysyłając żądanie POST do endpointu \texttt{/add-to-cart/<int:product\_id>/}.
    \item \textbf{Kod:}
\begin{lstlisting}[language=JavaScript, caption=Kod funkcji add-to-cart]
$('.add-to-cart').click(function (event) {
    event.preventDefault();
    const productId = $(this).data('product-id');
    const quantity = $(this).data('quantity') || 1;

    $.ajax({
        url: '/add-to-cart/' + productId + '/',
        type: 'POST',
        headers: { 'X-CSRFToken': csrftoken },
        data: { quantity: quantity },
        success: function (response) {
            if (response.success) {
                alert("Produkt zostal dodany do koszyka!");
            }
        }
    });
});
\end{lstlisting}
    \item \textbf{Powiązane elementy w szablonie:}
    \begin{itemize}
        \item Przycisk \texttt{.add-to-cart} w szablonach produktów.
    \end{itemize}
\end{itemize}






\subsection{Środowisko programistyczne}
\textit{Opis instalacji i konfiguracji niezbędnego środowiska programistycznego potrzebnego do ewentualnej dalszej pracy deweloperskiej z projektem (system operacyjny, wszelkie niezbędne narzędzia, biblioteki itp. wraz z sugerowanymi/minimalnymi ich wersjami).}





\renewcommand\refname{Literatura (jeżeli wymagana)}
\bibliography{references}
\addcontentsline{toc}{section}{Literatura}
% --------------------------------------------------------------------
%%%%%%% odkomentować gdy bibliografia ma być wewnątrz dokumentu
% --------------------------------------------------------------------
%\begin{thebibliography}{11}
%
%\addcontentsline{toc}{section}{Literatura}
%
%\bibitem{ZAN}
%C. Zannoni and P. Pasini, 
%\emph{Advances in the Computer Simulatons of Liquid Crystals}, Kluwer Academic Publishers, 2000.
%
%\end{thebibliography}

\end{document}

